"use strict";(self["webpackChunksubscriptions"]=self["webpackChunksubscriptions"]||[]).push([[472],{3472:function(s,e,t){t.r(e),t.d(e,{default:function(){return P}});var i=t(3396),r=t(7139),a=t(9242),o=t(1605),c=t(5748);const n=s=>((0,i.dD)("data-v-8af4b662"),s=s(),(0,i.Cn)(),s),d={class:"basket"},l={class:"basket__wrapper container"},u={key:0,class:"notify"},h={key:1,class:"price"},p={class:"price_sum"},b=n((()=>(0,i._)("span",{class:"ruble"}," ₽ ",-1))),k={key:0,class:"price_dur"},w={key:1,class:"price_dur"},m={key:2,class:"price"},y={class:"price_sum"},_=n((()=>(0,i._)("span",{class:"ruble"}," ₽ ",-1))),M={key:0,class:"price_dur"},f={key:1,class:"price_dur"},v={class:"agreement"},S=n((()=>(0,i._)("span",{class:"ruble"}," ₽ ",-1))),g=n((()=>(0,i._)("img",{src:o,alt:"error",class:"modal__header_img",width:"50",height:"50"},null,-1))),A=n((()=>(0,i._)("img",{src:c,alt:"error",class:"modal__header_img",width:"50",height:"50"},null,-1)));function U(s,e,t,o,c,n){const U=(0,i.up)("Btn"),C=(0,i.up)("ModalWindow");return(0,i.wg)(),(0,i.iD)(i.HY,null,[(0,i._)("div",d,[(0,i._)("div",l,[s.servicesSum[s.duration]?s.servicesSum[s.duration]&&s.hasAddTrial?((0,i.wg)(),(0,i.iD)("p",h,[(0,i.Uk)((0,r.zw)(s.subscription.freePeriod)+" бесплатно,  ",1),(0,i._)("span",p,[(0,i.Uk)(" потом "+(0,r.zw)(s.servicesSum[s.duration])+" ",1),b,1===s.duration?((0,i.wg)(),(0,i.iD)("span",k," /мес ")):(0,i.kq)("",!0),12===s.duration?((0,i.wg)(),(0,i.iD)("span",w," /год ")):(0,i.kq)("",!0)])])):((0,i.wg)(),(0,i.iD)("p",m,[(0,i.Uk)(" Стоимость подписки  "),(0,i._)("span",y,[(0,i.Uk)((0,r.zw)(s.servicesSum[s.duration])+" ",1),_,1===s.duration?((0,i.wg)(),(0,i.iD)("span",M," /мес ")):(0,i.kq)("",!0),12===s.duration?((0,i.wg)(),(0,i.iD)("span",f," /год ")):(0,i.kq)("",!0)])])):((0,i.wg)(),(0,i.iD)("p",u," Выберите хотя бы одну услугу ")),(0,i.Wm)(U,{class:(0,r.C_)(["btn",[{inactive:!0===s.clicked},{disabled:!s.selectedServicesList.length}]]),color:s.selectedServicesList.length?"":"gray",onClick:s.conditionalAction},{default:(0,i.w5)((()=>[(0,i.Uk)((0,r.zw)(s.hasAddTrial?"Попробовать бесплатно":"Оформить подписку"),1)])),_:1},8,["color","class","onClick"]),(0,i._)("p",v,[(0,i.Uk)(" Я принимаю "),(0,i._)("a",{href:"https://www.is74.ru/mobile_app/agreement.pdf",onClick:e[0]||(e[0]=e=>s.$store.dispatch("sendUserEvent","YardSubTerms"))}," условия подписки ")])])]),(0,i.wy)((0,i.Wm)(C,{onClick:(0,a.iM)(s.closeModal,["self"])},(0,i.Nv)({title:(0,i.w5)((()=>[(0,i.Uk)((0,r.zw)(s.hasAddTrial?"Бесплатный период":"Подключить подписку?"),1)])),footer:(0,i.w5)((()=>[(0,i.Wm)(U,{color:"gray",small:"",onClick:s.closeModal},{default:(0,i.w5)((()=>[(0,i.Uk)(" Отменить ")])),_:1},8,["onClick"]),(0,i.Wm)(U,{small:"",class:(0,r.C_)({disabled:s.clicked}),onClick:s.subscribe},{default:(0,i.w5)((()=>[(0,i.Uk)((0,r.zw)(s.hasAddTrial?"Попробовать":"Подключить"),1)])),_:1},8,["class","onClick"])])),_:2},[s.hasAddTrial?{name:"description",fn:(0,i.w5)((()=>[(0,i.Uk)(" Пользуйтесь услугой бесплатно "+(0,r.zw)(s.subscription.freePeriod)+"! Затем с лицевого счета или привязанной карты будет взиматься плата - "+(0,r.zw)(s.servicesSum[s.duration])+" ",1),S,(0,i.Uk)("/мес ")])),key:"0"}:{name:"description",fn:(0,i.w5)((()=>[(0,i.Uk)(" C лицевого счета или привязанной карты будет списываться "+(0,r.zw)(s.servicesSum[s.duration])+" ",1),(0,i._)("span",{class:"ruble"}," ₽ "),(0,i.Uk)("/мес ")])),key:"1"}]),1032,["onClick"]),[[a.F8,s.showSubscribeModal]]),(0,i.wy)((0,i.Wm)(C,{onClick:e[1]||(e[1]=(0,a.iM)((e=>s.subscribeSuccessModal=!1),["self"]))},{title:(0,i.w5)((()=>[g,(0,i.Uk)(" Подписка успешно подключена! ")])),footer:(0,i.w5)((()=>[(0,i.Wm)(U,{color:"gray",class:"successModalBtn",small:"",onClick:s.goToMyYard},{default:(0,i.w5)((()=>[(0,i.Uk)(" Готово ")])),_:1},8,["onClick"])])),_:1},512),[[a.F8,s.subscribeSuccessModal]]),(0,i.wy)((0,i.Wm)(C,{onClick:e[3]||(e[3]=(0,a.iM)((e=>s.subscribeErrorModal=!1),["self"]))},{title:(0,i.w5)((()=>[A,(0,i.Uk)(" Не удалось подключить подписку! ")])),footer:(0,i.w5)((()=>[(0,i.Wm)(U,{color:"gray",class:"successModalBtn",small:"",onClick:e[2]||(e[2]=e=>s.subscribeErrorModal=!1)},{default:(0,i.w5)((()=>[(0,i.Uk)(" Готово ")])),_:1})])),_:1},512),[[a.F8,s.subscribeErrorModal]])],64)}t(7658);var C=t(6205),T=t(9370),E=(0,i.aZ)({name:"Basket",components:{ModalWindow:(0,i.RC)((()=>t.e(349).then(t.bind(t,5349)))),Btn:(0,i.RC)((()=>t.e(286).then(t.bind(t,8286))))},props:{selectedServicesList:{type:Array,required:!0},servicesSum:{type:Object,required:!0},duration:{type:Number,required:!0}},data:()=>({clicked:!1,subscription:{},showSubscribeModal:!1,subscribeSuccessModal:!1,subscribeErrorModal:!1}),computed:{hasAddTrial(){return this.$store.state.abonentInfo.hasAddTrial},abonentType(){return this.$store.state.abonentInfo.abonentType},isNotAbonent(){return"not_abonent"===this.abonentType},payMethod(){if(this.$store.state.payMethod)return this.$store.state.payMethod;{const s=this.isNotAbonent?"card":"ls";return this.$store.dispatch("changePayMethod",s),this.$store.state.payMethod}}},mounted(){this.getSubscription().then((s=>this.subscription=s))},methods:{async getSubscription(){return fetch((0,T.$T)(),{headers:{Authorization:`Bearer ${T.bl.TOKEN}`}}).then((async s=>{if(200===s.status)return s.json();throw new Error(await s.text())})).catch(console.error)},async subscribe(){const s=[];Object.keys(this.selectedServicesList).forEach((e=>{s.push(+this.selectedServicesList[e])})),this.hasAddTrial||this.$store.dispatch("sendUserEvent","YardSubRepeatActivate"),"ls"===this.payMethod&&this.$store.dispatch("sendUserEvent","YardSubPersonalAccountActivate");const e={serviceIds:s,periodMonth:this.duration},t=`isapp://lk?screen=SubscriptionPay&sum=${this.hasAddTrial?"1&trial=true":this.servicesSum[this.duration]}`;if(!this.clicked){this.clicked=!0;const s=await(0,C.YY)(e);if(s&&this.servicesSum[this.duration])if("not_abonent"!==this.abonentType&&"ls"===this.payMethod){const s=await(0,C.rv)();this.showSubscribeModal=!1,s?(this.subscribeSuccessModal=!0,this.$store.dispatch("sendUserEvent","YardSubPersonalAccountSuccess")):(this.subscribeErrorModal=!0,this.$store.dispatch("sendUserEvent","YardSubPersonalAccountFail"))}else this.deepLinkImitator(t),setTimeout(this.closeModal,2e3);setTimeout((()=>this.clicked=!1),2e3)}},deepLinkImitator(s){const e=document.createElement("a");e.setAttribute("href",s),e.click()},closeModal(){this.showSubscribeModal=!1,this.hasAddTrial||this.$store.dispatch("sendUserEvent","YardSubRepeatCancel"),"ls"===this.payMethod&&this.$store.dispatch("sendUserEvent","YardSubPersonalAccountCancel")},openModal(){this.showSubscribeModal=!0,this.$store.dispatch("sendUserEvent","YardSubPressOrder"),this.hasAddTrial||this.$store.dispatch("sendUserEvent","YardSubRepeatView"),"ls"===this.payMethod&&this.$store.dispatch("sendUserEvent","YardSubPersonalAccountView")},goToMyYard(){this.deepLinkImitator("isapp://lk?screen=MyYardPaySuccess")},conditionalAction(){this.isNotAbonent&&this.hasAddTrial?this.subscribe():this.openModal()}}}),$=t(7477);const Y=(0,$.Z)(E,[["render",U],["__scopeId","data-v-8af4b662"]]);var P=Y},5748:function(s,e,t){s.exports=t.p+"img/modal_error.2a620092.svg"},1605:function(s,e,t){s.exports=t.p+"img/modal_success.b152f5c3.svg"}}]);
//# sourceMappingURL=472.79127fee.js.map